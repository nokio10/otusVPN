- hosts: all
  become: yes
  tasks:
  - name: install epel-release
    yum:
      name: epel-release
      state: present
      update_cache: true
  - name: install base tools
    yum:
      name:
        - openvpn
        - iperf3
      state: present
      update_cache: true
  - name: setenforce 0 
    selinux:
      state: disabled
- hosts: server
  become: yes
  tasks:
  - name: Copy conf
    template: 
      src: server.conf.j2
      dest: /etc/openvpn/server.conf
      owner: root
      group: root
      mode: 0640
  - name: Copy secret
    template: 
      src: secret
      dest: /etc/openvpn/static.key
      owner: root 
      group: root 
      mode: 0600
  - name: restart openvpn
    systemd:
      name: openvpn@server
      state: restarted
      enabled: true 
- hosts: client
  become: yes
  tasks:
  - name: Copy conf
    template: 
      src: client.server.conf.j2
      dest: /etc/openvpn/server.conf
      owner: root
      group: root
      mode: 0640
  - name: Copy secret
    template:
      src: secret
      dest: /etc/openvpn/static.key
      owner: root
      group: root
      mode: 0600
  - name: restart openvpn
    systemd:
      name: openvpn@server
      state: restarted
      enabled: true 
      
      
